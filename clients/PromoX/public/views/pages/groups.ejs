<!-- Main Wrapper -->
<section class="w-full max-w-sm bg-white rounded-xl shadow-2xl flex flex-col pb-10 absolute top-0 bottom-0">

    <!-- Page Heading -->
    <div class="px-6 py-2 border-b border-gray-200">
        <h2 class="text-xl font-bold text-gray-800 flex items-center gap-3">
            <svg fill="#24A1DE" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="-2.4 -2.4 28.80 28.80" xml:space="preserve"
                width="50px" height="50px" stroke="#24A1DE" transform="rotate(0)">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" stroke="#CCCCCC"
                    stroke-width="0.048"></g>
                <g id="SVGRepo_iconCarrier">
                    <style type="text/css">
                        .st0 {
                            fill: none;
                        }
                    </style>
                    <path
                        d="M19.2,4.4L2.9,10.7c-1.1,0.4-1.1,1.1-0.2,1.3l4.1,1.3l1.6,4.8c0.2,0.5,0.1,0.7,0.6,0.7c0.4,0,0.6-0.2,0.8-0.4 c0.1-0.1,1-1,2-2l4.2,3.1c0.8,0.4,1.3,0.2,1.5-0.7l2.8-13.1C20.6,4.6,19.9,4,19.2,4.4z M17.1,7.4l-7.8,7.1L9,17.8L7.4,13l9.2-5.8 C17,6.9,17.4,7.1,17.1,7.4z">
                    </path>
                    <rect y="0" class="st0" width="24" height="24"></rect>
                </g>
            </svg>
            <span>Telegram Groups</span>
        </h2>
    </div>

    <!-- Main Content -->
    <main id="group-list" class="flex-1 overflow-y-auto px-6 py-6 space-y-6 animate-background">

        <% if (groups && groups.length> 0) { %>
            <% groups.forEach(group=> { %>
                <!-- Group Card -->
                <div
                    class="bg-white rounded-lg shadow p-4 border border-gray-100 grid grid-cols-[auto_1fr_auto] gap-4 items-center">

                    <!-- Logo -->
                    <% if (group.logoBase64) { %>
                        <img src="<%= group.logoBase64 %>" alt="Group Logo"
                            class="w-14 h-14 rounded-full border border-gray-200 object-cover">
                        <% } else { %>
                            <div
                                class="w-14 h-14 flex items-center justify-center rounded-full border border-gray-200 bg-indigo-500 text-white font-bold text-lg">
                                <%= group.group_name ? group.group_name.charAt(0).toUpperCase() : '?' %>
                            </div>
                            <% } %>

                                <!-- Group Info -->
                                <div class="min-w-0">
                                    <!-- Title + Button -->
                                    <div class="flex items-center justify-between gap-2 mb-2">
                                        <h3 class="text-base font-semibold text-gray-800 truncate">
                                            <%= group.group_name %>
                                        </h3>
                                        <a href="https://t.me/<%= group.username %>" target="_blank" class="px-4 py-1 text-sm font-semibold text-white rounded-xl shadow-lg 
               bg-gradient-to-r from-green-500 to-green-600 
               hover:from-green-600 hover:to-green-700 
               transform hover:scale-105 transition-all duration-200 ease-in-out flex-shrink-0">
                                            ðŸš€ Join
                                        </a>
                                    </div>

                                    <!-- Username -->
                                    <p class="text-xs text-gray-500 truncate">@<%= group.username %>
                                    </p>

                                    <!-- Category -->
                                    <span
                                        class="inline-block mt-1 px-2 py-0.5 text-xs bg-indigo-100 text-indigo-700 rounded-full">
                                        <%= group.category %>
                                    </span>

                                    <!-- Description -->
                                    <p class="text-xs text-gray-600 mt-2">
                                        <%= group.short_description %>
                                    </p>
                                </div>
                </div>

                <% }) %>
                    <% } else { %>
                        <p class="text-center text-gray-500 text-sm">No groups found.</p>
                        <% } %>

    </main>

    <!-- Unlock Overlay -->
    <div id="unlock-section"
        class="flex flex-col items-center justify-center fixed top-0 left-0 right-0 bottom-12 bg-white/30 backdrop-blur-sm z-50">
        <p onclick="unlockPage()"
            class="px-6 py-3 text-sm font-semibold bg-yellow-500 text-white rounded-lg shadow hover:bg-yellow-600 transition">
            ðŸ”“ Unlock Groups
        </p>
        <p class="mt-2 text-xs text-gray-500 text-center">
            Click to view all promoted Telegram groups.
        </p>
    </div>

    <!-- Bottom Nav -->
    <%- include('../partials/footer') %>

        <!-- Full Page Loader -->
        <div id="pageLoader" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="flex flex-col items-center space-y-4">
                <svg class="animate-spin h-12 w-12 text-white" xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                </svg>
                <span class="text-white text-lg">Loading...</span>
            </div>
        </div>
</section>

<script>
    function lockScroll() {
        document.body.style.overflow = 'hidden';
    }

    function unlockScroll() {
        document.body.style.overflow = '';
    }

    async function unlockPage() {
        const pageLoader = document.getElementById("pageLoader");

        // Show full page loader before running show_9690148
        pageLoader.classList.remove("hidden");

        await show_9690148('pop');

        // Hide loader after it finishes
        pageLoader.classList.add("hidden");

        // Confirmation before unlock
        if (!confirm("Are you sure you want to Unlock?")) {
            return; // User cancelled
        }

        axios.get('/<%= token %>/promox/unlock/groups')
            .then(res => {
                const data = res.data;
                if (data.success) {
                    document.getElementById('unlock-section').classList.add('hidden');
                    unlockScroll();
                    alert("Successfully unlocked for 24 hours");
                }
            })
            .catch(err => alert('Server Error please Contact Admin'));
    }

    window.addEventListener('DOMContentLoaded', () => {
        const isUnlocked = '<%= is_group_page_locked %>' === 'true';
        if (isUnlocked) {
            lockScroll();
        } else {
            document.getElementById('unlock-section').classList.add('hidden');
            unlockScroll();
        }
    });
</script>