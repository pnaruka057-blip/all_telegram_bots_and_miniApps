<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src='//libtl.com/sdk.js' data-zone='10401286' data-sdk='show_10401286'></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script async src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        window.addEventListener("DOMContentLoaded", async () => {
            /**
             * Wait briefly for the Telegram WebApp script to become available.
             * Some browsers may load the async script slightly after DOMContentLoaded on first open.
             */
            const waitForTelegram = async (timeoutMs = 500) => {
                const start = Date.now();
                while (!(window.Telegram && window.Telegram.WebApp) && (Date.now() - start) < timeoutMs) {
                    await new Promise(r => setTimeout(r, 50));
                }
                return !!(window.Telegram && window.Telegram.WebApp);
            };

            const tgAvailable = await waitForTelegram(500); // wait up to 500ms
            if (!tgAvailable) {
                // Telegram WebApp not present â€” show message and stop further execution
                document.body.innerHTML = '<div class="text-center mt-10 text-red-600 text-lg">Please open this in Telegram</div>';
                return;
            }

            const tg = window.Telegram.WebApp;

            // Safe calls to ready() / expand()
            try {
                if (typeof tg.ready === 'function') tg.ready();
            } catch (e) { /* ignore */ }
            try {
                if (typeof tg.expand === 'function') tg.expand();
            } catch (e) { /* ignore */ }

            const initDataUnsafe = tg.initDataUnsafe || {};
            const user = initDataUnsafe.user;

            // If Telegram did not provide a user object, show same message and stop
            if (!user) {
                document.body.innerHTML = '<div class="text-center mt-10 text-red-600 text-lg">Please open this in Telegram</div>';
                return;
            }
        });
    </script>
    <style>
        .hidden {
            display: none;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .animate-background {
            background: linear-gradient(-45deg, #0f0f0f, #1a1a40, #3d0000, #1a1a40);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
            color: #f5f5f5;
            /* text visible hoga white/gray me */
        }

        /* optional: text ko thoda neon effect dena */
        .animate-background h1,
        .animate-background p {
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.6);
        }

        .animate-background label {
            color: white;
        }

        .animate-background input,
        .animate-background select {
            color: black;
        }

        .truncate-3-lines {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        @keyframes verticalScroll {
            0% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-20%);
            }

            /* scroll up */
            100% {
                transform: translateY(0);
            }

            /* scroll back to top */
        }

        .animate-verticalScroll {
            animation: verticalScroll 8s ease-in-out infinite;
        }
    </style>

</head>

<body class="bg-gray-800 flex justify-center items-center select-none">
    <!-- Page Loader -->
    <div id="pageLoader"
        class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] flex items-center justify-center hidden">
        <div class="flex space-x-2">
            <div class="w-3 h-3 bg-white rounded-full animate-bounce [animation-delay:0s]"></div>
            <div class="w-3 h-3 bg-white rounded-full animate-bounce [animation-delay:0.2s]"></div>
            <div class="w-3 h-3 bg-white rounded-full animate-bounce [animation-delay:0.4s]"></div>
        </div>
    </div>

    <%- body %> <!-- dynamic page content -->

        <script>
            document.addEventListener("DOMContentLoaded", () => {
                // Event delegation: body pe listen karo
                document.body.addEventListener("click", function (e) {
                    const link = e.target.closest("a");
                    if (!link) return;

                    const href = link.getAttribute("href");
                    if (href && !href.startsWith("http") && !href.startsWith("#") && !link.hasAttribute("target")) {
                        document.getElementById("pageLoader").classList.remove("hidden");
                    }
                });
            });
        </script>
</body>
<script>

</script>

</html>