<section class="w-full max-w-2xl mx-auto bg-white rounded-xl shadow-lg p-6 mt-10">
  <h1 class="text-xl font-bold text-gray-800 mb-4">Send Request</h1>

  <form id="requestForm" class="space-y-4">

    <!-- Type Selection (Locked) -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
      <div class="flex space-x-4">
        <label class="flex items-center space-x-2">
          <input type="radio" name="type" value="movie" <%=type==="movie" ? "checked" : "" %> disabled>
          <span>Movie</span>
        </label>
        <label class="flex items-center space-x-2">
          <input type="radio" name="type" value="show" <%=type==="show" ? "checked" : "" %> disabled>
          <span>Show</span>
        </label>
      </div>
    </div>

    <!-- Requested Item Title (Locked) -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Requested Title</label>
      <input type="text" name="title" value="<%= query %>"
        class="w-full px-3 py-2 border rounded-lg bg-gray-100 cursor-not-allowed" readonly>
    </div>

    <!-- User Info (Readonly Preview) -->
    <% if (user) { %>
      <div class="p-3 border rounded-lg bg-gray-50">
        <p class="text-sm text-gray-700"><strong>Name:</strong>
          <%= user.name %>
        </p>
        <p class="text-sm text-gray-700"><strong>Username:</strong> @<%= user.username %>
        </p>
        <p class="text-sm text-gray-700"><strong>Profile Logo:</strong>
          <%= user.profile_logo %>
        </p>
      </div>
      <% } %>

        <!-- Language Selection -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Language</label>
          <select name="language" class="w-full px-3 py-2 border rounded-lg">
            <% const langs=["Hindi", "English" , "Tamil" , "Telugu" , "Kannada" , "Malayalam" ]; %>
              <% langs.forEach(lang=> { %>
                <option value="<%= lang %>" <%=user && user.language===lang ? "selected" : "" %>>
                  <%= lang %>
                </option>
                <% }) %>
          </select>
        </div>

        <!-- Hidden Inputs -->
        <input type="hidden" name="user_id" value="<%= user ? user.user_id : '' %>">
        <input type="hidden" name="type" value="<%= type %>">

        <!-- Submit Button -->
        <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700">
          Send Request
        </button>
  </form>
</section>

<script>
  document.getElementById("requestForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const formData = new FormData(this);
    const payload = Object.fromEntries(formData.entries());

    try {
      const res = await axios.post("/<%= token %>/movies-hub/send-request", payload);
      if (res.data.success) {
        alert("Request sent successfully!");
      } else {
        alert("Failed to send request.");
      }
    } catch (err) {
      console.error("Error sending request:", err);
      alert("Something went wrong!");
    }
  });
</script>