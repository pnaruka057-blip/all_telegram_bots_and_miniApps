<!-- Main Wrapper -->
<section class="w-full max-w-md bg-white rounded-xl shadow-2xl overflow-hidden flex flex-col min-h-[100svh]">

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto px-6 py-6 space-y-6 animate-background">

        <!-- Profile Section -->
        <div class="flex flex-col items-center text-center space-y-2">
            <!-- Give the img an id so we can update src client-side if server didn't provide user_logo -->
            <img id="profileImg" src="<%= user && user.user_logo ? user.user_logo : '' %>" alt="Profile Picture"
                class="w-24 h-24 rounded-full shadow-lg border">

            <h2 class="text-lg font-bold">
                <%= user.name %>
            </h2>
            <p class="text-gray-500">@<%= user.username %>
            </p>
            <span class="text-sm text-gray-400">ID: <%= user.user_id %></span>
        </div>

        <!-- Read-only Info -->
        <div class="bg-gray-50 border rounded-xl p-4 space-y-2">
            <div class="flex items-center justify-between">
                <span class="text-sm text-gray-500">Name</span>
                <span class="text-sm font-semibold text-gray-800">
                    <%= user.name %>
                </span>
            </div>
            <div class="flex items-center justify-between">
                <span class="text-sm text-gray-500">Username</span>
                <span class="text-sm font-semibold text-gray-800">@<%= user.username %></span>
            </div>
            <div class="flex items-center justify-between">
                <span class="text-sm text-gray-500">User ID</span>
                <span class="text-sm font-semibold text-gray-800">
                    <%= user.user_id %>
                </span>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <%- include('../partials/footer') %>
</section>

<script>
    /**
     * Client-side logic to set profile image:
     * - If server passed user.user_logo (non-empty), keep it.
     * - Else, try Telegram WebApp initDataUnsafe.user.photo_url.
     * - If not available, use Cloudinary fallback image.
     */
    (function () {
        const FALLBACK = 'https://res.cloudinary.com/dm8miilli/image/upload/v1755791642/profile_hbb9k4.png';

        document.addEventListener('DOMContentLoaded', () => {
            try {
                const img = document.getElementById('profileImg');
                if (!img) return;

                const initialSrc = (img.getAttribute('src') || '').trim();
                if (initialSrc) return;

                const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
                try { tg && typeof tg.ready === 'function' && tg.ready(); } catch (e) { }

                const tgUser = tg && tg.initDataUnsafe ? tg.initDataUnsafe.user : null;
                if (tgUser && tgUser.photo_url) img.src = tgUser.photo_url;
                else img.src = FALLBACK;
            } catch (err) {
                try {
                    const img = document.getElementById('profileImg');
                    if (img) img.src = FALLBACK;
                } catch (e) { }
                console.error('Profile image init error:', err);
            }
        });
    })();
</script>