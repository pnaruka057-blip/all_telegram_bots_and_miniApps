<section class="mx-auto w-full max-w-2xl px-4 py-6">
    <!-- HERO -->
    <%- include('../partials/header') %>

        <header
            class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-800 dark:bg-slate-900">
            <div class="flex flex-wrap items-center gap-4">
                <img class="h-16 w-16 rounded-full object-cover ring-2 ring-slate-200 shadow-sm dark:ring-slate-700"
                    src="https://cdn5.telesco.pe/file/eHO-n1MotMHBIgPr7ygqzYpbPPRcjuAuxZZt-Yo7Rm7koENXdufk4k9XGj5pIko-M32tA-AlfS0asFfIvfqYqp-l2e7psXXfXzOc_-BmNpOa1L75rjVjU8dEctek_TpL3Fd-9unw4IyS--kVGGzV9iP7SPby8Jx0kf7rc92n6yfhtl_yG6Dk1nvTZYf3D2wuOj7fFOwJAe_pT6L0I1rkf91NEgWdX8OxV2p8vHW8OETJXHiXnmzVC1Jjh9lZT55Dk9TCYcyKS8mxTT68RLpnS98FkOUMV-pMJTOqwJrmRpdCJ6IMRY-55dY6ZY1r6vO_z9I_nvC5oQAyRgGMkp4xaA.jpg"
                    alt="Group Help Advance" loading="lazy" />

                <div class="min-w-[220px] flex-1">
                    <h1 class="text-lg font-semibold text-slate-900 dark:text-slate-100">Group Help Advance</h1>

                    <p class="mt-1 text-sm leading-6 text-slate-600 dark:text-slate-300">
                        Create Telegram-ready messages & inline button layouts quickly using built-in design tools.
                    </p>

                    <div class="mt-2 flex flex-wrap gap-x-4 gap-y-2 text-sm">
                        <a class="text-blue-600 hover:underline dark:text-blue-400"
                            href="/<%= token %>/group-help-advance/privacy-policy">
                            Privacy Policy
                        </a>
                    </div>
                </div>
            </div>

            <div class="mt-4 flex flex-col gap-2 sm:flex-row sm:flex-wrap">
                <a class="inline-flex items-center justify-center rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700 active:scale-[0.99]"
                    href="/<%= token %>/group-help-advance/html_message_design">
                    Message Design (No Placeholders)
                </a>

                <a class="inline-flex items-center justify-center rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-900 shadow-sm hover:bg-slate-50 active:scale-[0.99]
                  dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100 dark:hover:bg-slate-900"
                    href="/<%= token %>/group-help-advance/html_message_design?placeholders=true">
                    Message Design (With Placeholders)
                </a>

                <a class="inline-flex items-center justify-center rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-900 shadow-sm hover:bg-slate-50 active:scale-[0.99]
                  dark:border-slate-700 dark:bg-slate-950 dark:text-slate-100 dark:hover:bg-slate-900"
                    href="/<%= token %>/group-help-advance/buttons-design">
                    Button Design
                </a>
            </div>
        </header>

        <main class="mt-5 grid grid-cols-1 gap-4 sm:grid-cols-2">
            <article
                class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-800 dark:bg-slate-900">
                <h2 class="text-sm font-semibold text-slate-900 dark:text-slate-100">Message Design</h2>
                <p class="mt-1 text-sm leading-6 text-slate-600 dark:text-slate-300">
                    Build Telegram HTML messages (bold, italic, links, code, etc.) and preview before using in your bot
                    settings.
                </p>
                <div class="mt-3">
                    <a class="inline-flex items-center justify-center rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700"
                        href="/<%= token %>/group-help-advance/html_message_design">
                        Open Designer
                    </a>
                </div>
            </article>

            <article
                class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-800 dark:bg-slate-900">
                <h2 class="text-sm font-semibold text-slate-900 dark:text-slate-100">Placeholders</h2>
                <p class="mt-1 text-sm leading-6 text-slate-600 dark:text-slate-300">
                    Create messages with placeholders (like user name, group title, IDs, etc.) for dynamic text in
                    welcome/rules.
                </p>
                <div class="mt-3">
                    <a class="inline-flex items-center justify-center rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700"
                        href="/<%= token %>/group-help-advance/html_message_design?placeholders=true">
                        Open With Placeholders
                    </a>
                </div>
            </article>

            <article
                class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm dark:border-slate-800 dark:bg-slate-900 sm:col-span-2">
                <h2 class="text-sm font-semibold text-slate-900 dark:text-slate-100">Button Design</h2>
                <p class="mt-1 text-sm leading-6 text-slate-600 dark:text-slate-300">
                    Generate inline keyboard layouts (rows/columns) and copy the final button syntax for your bot
                    configuration.
                </p>
                <div class="mt-3">
                    <a class="inline-flex items-center justify-center rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-700"
                        href="/<%= token %>/group-help-advance/buttons-design">
                        Open Button Builder
                    </a>
                </div>
            </article>
        </main>

        <%- include('../partials/footer') %>
</section>

<script>
    (function () {
        const root = document.documentElement;
        const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;

        function numCssVar(name) {
            const v = getComputedStyle(root).getPropertyValue(name);
            const n = parseFloat(v);
            return Number.isFinite(n) ? n : 0;
        }

        function setSafeVars() {
            let top = 0;
            let bottom = 0;

            // Prefer Telegram provided insets (new clients)
            try {
                top = tg?.safeAreaInset?.top ?? 0;
                bottom = tg?.safeAreaInset?.bottom ?? 0;
            } catch (e) { }

            // Fallback to Telegram CSS vars if present
            if (!top) top = numCssVar('--tg-safe-area-inset-top');
            if (!bottom) bottom = numCssVar('--tg-safe-area-inset-bottom');

            // Last fallback for iOS-like devices if everything is 0
            if (!top && /iPhone|iPad|iPod/i.test(navigator.userAgent)) top = 24;

            root.style.setProperty('--app-safe-top', top + 'px');
            root.style.setProperty('--app-safe-bottom', bottom + 'px');
        }

        setSafeVars();

        // Keep it updated when Telegram reports changes
        try { tg?.onEvent?.('safeAreaChanged', setSafeVars); } catch (e) { }
        try { tg?.onEvent?.('safe_area_changed', setSafeVars); } catch (e) { } // some wrappers emit snake_case [web:203][web:128]

        // Optional: set header/background color so status bar icons look correct in fullscreen [page:1]
        try {
            if (tg?.setHeaderColor && tg?.colorScheme) {
                tg.setHeaderColor(tg.colorScheme === 'dark' ? '#020617' : '#f8fafc');
            }
            if (tg?.setBackgroundColor && tg?.colorScheme) {
                tg.setBackgroundColor(tg.colorScheme === 'dark' ? '#020617' : '#f8fafc');
            }
        } catch (e) { }
    })();

    try {
        const tg = window.Telegram?.WebApp;
        tg.BackButton.hide();
    } catch (e) {
        console.error("CloseButton init error:", e);
    }
</script>

<!-- Ads on first page load (client-only) -->
<script>
    (function () {
        const ADS_BLOCK_ID = 'int-20322'; // <-- replace with your AdsGram block id
        const SESSION_KEY = 'home_page_ads_shown_v1';
        const SAFETY_TIMEOUT_MS = 8000;
        let AdController = null;
        let sdkLoaded = false;
        let sdkRequested = false;

        function loadAdsgramSDK() {
            return new Promise((resolve) => {
                if (sdkRequested) {
                    // wait until sdkLoaded becomes true or small timeout
                    const start = Date.now();
                    const check = setInterval(() => {
                        if (sdkLoaded || (Date.now() - start) > 1200) { clearInterval(check); resolve(sdkLoaded); }
                    }, 100);
                    return;
                }
                sdkRequested = true;

                if (window.Adsgram && typeof window.Adsgram.init === 'function') {
                    try {
                        AdController = window.Adsgram.init({ blockId: ADS_BLOCK_ID });
                        sdkLoaded = true;
                        resolve(true);
                        return;
                    } catch (e) {
                        console.error('Adsgram init error:', e);
                    }
                }

                const s = document.createElement('script');
                s.src = 'https://sad.adsgram.ai/js/sad.min.js';
                s.async = true;
                s.onload = function () {
                    try {
                        if (window.Adsgram && typeof window.Adsgram.init === 'function') {
                            AdController = window.Adsgram.init({ blockId: ADS_BLOCK_ID });
                            sdkLoaded = true;
                            resolve(true);
                            return;
                        }
                    } catch (err) {
                        console.error('Adsgram init after load failed:', err);
                    }
                    resolve(false);
                };
                s.onerror = function () {
                    console.error('Failed to load Adsgram SDK.');
                    resolve(false);
                };
                document.head.appendChild(s);

                // fallback resolve after short delay in case onload doesn't fire quickly
                setTimeout(() => { if (!sdkLoaded) resolve(sdkLoaded); }, 1200);
            });
        }

        async function showAdIfNeeded() {
            try {
                // Only show once per session/tab
                if (sessionStorage.getItem(SESSION_KEY)) return;

                // try to load SDK (non-blocking)
                const ready = await loadAdsgramSDK();

                // if no SDK, do nothing
                if (!ready || !AdController || typeof AdController.show !== 'function') return;

                // show ad with safety timeout
                const t = setTimeout(() => {
                    // if ad didn't start / resolve within timeout, just mark shown so we don't retry
                    try { sessionStorage.setItem(SESSION_KEY, '1'); } catch (e) { }
                }, SAFETY_TIMEOUT_MS);

                try {
                    const res = await AdController.show();
                    clearTimeout(t);
                    // mark as shown regardless of completion/skipped to avoid repeat
                    try { sessionStorage.setItem(SESSION_KEY, '1'); } catch (e) { }
                } catch (err) {
                    clearTimeout(t);
                    console.error('Adsgram show error:', err);
                    try { sessionStorage.setItem(SESSION_KEY, '1'); } catch (e) { }
                }
            } catch (e) {
                console.error('Error while attempting to show ad on page load', e);
                try { sessionStorage.setItem(SESSION_KEY, '1'); } catch (e) { }
            }
        }

        // Run on DOMContentLoaded - ensure page UI is ready first
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', showAdIfNeeded);
        } else {
            showAdIfNeeded();
        }
    })();
</script>