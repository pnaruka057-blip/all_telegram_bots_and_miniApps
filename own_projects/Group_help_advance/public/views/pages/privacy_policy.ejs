<% const BOT_NAME=(typeof botName !=="undefined" && botName) ? botName : "Group Help Advance Bot" ; const
    BOT_HANDLE=(typeof botHandle !=="undefined" && botHandle) ? botHandle : "@GroupHelpAdvanceBot" ; const
    BRAND_NAME=(typeof brandName !=="undefined" && brandName) ? brandName : "Group Help Advance" ; const
    SUPPORT_EMAIL=(typeof supportEmail !=="undefined" && supportEmail) ? supportEmail : "support@yourdomain.com" ; const
    SUPPORT_PEC=(typeof supportPecEmail !=="undefined" && supportPecEmail) ? supportPecEmail : "" ; const
    OWNER_NAME=(typeof ownerName !=="undefined" && ownerName) ? ownerName : "Your Name / Company" ; const
    OWNER_ADDRESS=(typeof ownerAddress !=="undefined" && ownerAddress) ? ownerAddress : "" ; const LAST_UPDATED=(typeof
    lastUpdated !=="undefined" && lastUpdated) ? lastUpdated : "December 29, 2025" ; const BOT_LOGO_URL=(typeof
    botLogoUrl !=="undefined" && botLogoUrl) ? botLogoUrl : "" ; %>

    <section class="min-h-screen bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-100">
        <!-- HERO -->
        <%- include('../partials/header') %>

            <!-- Sticky top bar -->
            <header
                class="sticky top-0 z-20 border-b border-slate-200/70 bg-slate-50/80 backdrop-blur dark:border-slate-800/70 dark:bg-slate-950/70">
                <div class="mx-auto flex max-w-3xl items-center gap-3 px-4 py-3">
                    <!-- Logo -->
                    <div class="shrink-0">
                        <% if (BOT_LOGO_URL && String(BOT_LOGO_URL).trim()) { %>
                            <img src="<%= BOT_LOGO_URL %>" alt="Bot logo"
                                class="h-10 w-10 rounded-2xl object-cover bg-white dark:bg-slate-900" loading="lazy" />
                            <% } else { %>
                                <div
                                    class="h-10 w-10 rounded-2xl bg-slate-900 text-white dark:bg-white dark:text-slate-900 flex items-center justify-center font-semibold">
                                    GH
                                </div>
                                <% } %>
                    </div>

                    <!-- Title -->
                    <div class="min-w-0">
                        <p class="text-xs text-slate-600 dark:text-slate-400">Telegram Bot</p>
                        <h1 class="truncate text-base font-semibold sm:text-lg">
                            <%= BOT_NAME %>
                        </h1>
                    </div>
                </div>
            </header>

            <main class="mx-auto max-w-3xl px-4 pb-12 pt-6">
                <!-- Intro (no boxes/cards) -->
                <div class="space-y-2">
                    <h2 class="text-xl font-semibold tracking-tight sm:text-2xl">Privacy Policy</h2>

                    <p class="text-sm leading-relaxed text-slate-700 dark:text-slate-300">
                        At <span class="font-medium">
                            <%= BRAND_NAME %>
                        </span>, the privacy and safety of users and groups is a priority.
                        This Privacy Policy describes what information may be processed while operating the Telegram
                        bot(s),
                        why it is processed,
                        and what rights you have.
                    </p>

                    <p class="text-sm leading-relaxed text-slate-700 dark:text-slate-300">
                        This page also explains how you use <span class="font-medium">
                            <%= BOT_HANDLE %>
                        </span> and any connected bots/services.
                    </p>

                    <p class="text-sm leading-relaxed text-slate-700 dark:text-slate-300">
                        If you have questions or you want to make a privacy request, contact us through the bot’s
                        Support
                        button or email
                        <a class="underline decoration-slate-400 underline-offset-4 hover:decoration-slate-700 dark:decoration-slate-600 dark:hover:decoration-slate-200"
                            href="mailto:<%= SUPPORT_EMAIL %>">
                            <%= SUPPORT_EMAIL %>
                        </a>.
                    </p>
                </div>

                <!-- Normal (no collapse) -->
                <div class="mt-6 space-y-8">

                    <section>
                        <h3 class="text-sm font-semibold text-slate-900 dark:text-slate-100">Scope</h3>
                        <div class="mt-2 text-sm leading-relaxed text-slate-700 dark:text-slate-300">
                            <ul class="list-disc pl-5 space-y-1">
                                <li>This policy applies to interactions on Telegram with <%= BOT_HANDLE %> and any
                                        connected
                                        bots/services.</li>
                                <li>It covers data that you provide, data generated by using bot features, and data that
                                    Telegram shares through its APIs.</li>
                                <li>It does not cover offline collection or third-party services not used by the bot.
                                </li>
                            </ul>
                        </div>
                    </section>

                    <section>
                        <h3 class="text-sm font-semibold text-slate-900 dark:text-slate-100">Lawful bases</h3>
                        <div class="mt-2 space-y-2 text-sm leading-relaxed text-slate-700 dark:text-slate-300">
                            <p>
                                Consent is not always requested because certain minimal processing is necessary to
                                provide
                                the group-protection
                                and moderation features requested by group owners/admins, and to operate the bot
                                reliably.
                            </p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li><span class="font-semibold">Public interest & safety:</span> helping groups reduce
                                    spam/abuse and enforce rules.</li>
                                <li><span class="font-semibold">Legitimate interests:</span> allowing administrators to
                                    manage communities efficiently and securely.</li>
                                <li><span class="font-semibold">Necessity:</span> when you choose to use bot features,
                                    processing is needed to deliver them.</li>
                            </ul>
                        </div>
                    </section>

                    <section>
                        <h3 class="text-sm font-semibold text-slate-900 dark:text-slate-100">Data we may process</h3>
                        <div class="mt-2 space-y-4 text-sm leading-relaxed text-slate-700 dark:text-slate-300">
                            <p>
                                The bot is designed to store only what is needed for moderation, automation, analytics
                                for
                                group health, and support handling.
                                Depending on which features are enabled by a group admin, the bot may process the
                                categories
                                below.
                            </p>

                            <div class="space-y-2">
                                <h4 class="text-sm font-semibold text-slate-900 dark:text-slate-100">1) Basic Telegram
                                    account details</h4>
                                <ul class="list-disc pl-5 space-y-1">
                                    <li>Examples: Telegram user ID, display name, username (if any), language,
                                        timestamps
                                        (when available).</li>
                                    <li>Purpose: moderation commands, abuse prevention, audits.</li>
                                </ul>
                            </div>

                            <div class="space-y-2">
                                <h4 class="text-sm font-semibold text-slate-900 dark:text-slate-100">2) Group activity &
                                    membership metadata</h4>
                                <ul class="list-disc pl-5 space-y-1">
                                    <li>Examples: group identifiers, membership status, activity timestamps, counters
                                        (feature-dependent).</li>
                                    <li>Purpose: group analytics, moderation workflows.</li>
                                </ul>
                            </div>

                            <div class="space-y-2">
                                <h4 class="text-sm font-semibold text-slate-900 dark:text-slate-100">3) Admin/owner
                                    permissions metadata</h4>
                                <ul class="list-disc pl-5 space-y-1">
                                    <li>Examples: creator/admin status and permissions (as provided by Telegram).</li>
                                    <li>Purpose: authorize settings panels and privileged commands.</li>
                                </ul>
                            </div>

                            <div class="space-y-2">
                                <h4 class="text-sm font-semibold text-slate-900 dark:text-slate-100">4) Warnings /
                                    punishments (feature-dependent)</h4>
                                <ul class="list-disc pl-5 space-y-1">
                                    <li>Examples: warning count, mute/ban records and expiry.</li>
                                    <li>Purpose: consistent enforcement of anti-spam/anti-abuse rules.</li>
                                </ul>
                            </div>

                            <div class="space-y-2">
                                <h4 class="text-sm font-semibold text-slate-900 dark:text-slate-100">5) Support requests
                                </h4>
                                <ul class="list-disc pl-5 space-y-1">
                                    <li>Examples: messages you send to support, timestamps, related identifiers.</li>
                                    <li>Purpose: provide support, investigate abuse, improve service quality.</li>
                                </ul>
                            </div>
                        </div>
                    </section>

                    <section>
                        <h3 class="text-sm font-semibold text-slate-900 dark:text-slate-100">Data sharing</h3>
                        <div class="mt-2 text-sm leading-relaxed text-slate-700 dark:text-slate-300">
                            <ul class="list-disc pl-5 space-y-1">
                                <li>Telegram: bot uses Telegram APIs; Telegram processes data under its own policies.
                                </li>
                                <li>Group staff: group-related info may be visible to authorized admins/moderators via
                                    bot
                                    features.</li>
                                <li>Service operators: limited access for operations/support and abuse handling.</li>
                            </ul>
                        </div>
                    </section>

                    <section>
                        <h3 class="text-sm font-semibold text-slate-900 dark:text-slate-100">Your data protection rights
                        </h3>
                        <div class="mt-2 space-y-2 text-sm leading-relaxed text-slate-700 dark:text-slate-300">
                            <p>
                                Depending on your jurisdiction, you may have rights such as access, correction,
                                deletion,
                                restriction, and complaint rights.
                            </p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li><span class="font-semibold">Access:</span> request a copy of data we hold about you.
                                </li>
                                <li><span class="font-semibold">Erasure:</span> request deletion, unless required for
                                    safety/legal reasons.</li>
                                <li><span class="font-semibold">Restriction/Objection:</span> request limited processing
                                    in
                                    certain cases.</li>
                            </ul>
                        </div>
                    </section>

                    <section>
                        <h3 class="text-sm font-semibold text-slate-900 dark:text-slate-100">Children’s information</h3>
                        <div class="mt-2 text-sm leading-relaxed text-slate-700 dark:text-slate-300">
                            <p>
                                The service is not intended to knowingly collect personal data from children under the
                                age
                                required by applicable law.
                            </p>
                        </div>
                    </section>

                    <section>
                        <h3 class="text-sm font-semibold text-slate-900 dark:text-slate-100">Contact (data
                            controller/operator)</h3>
                        <div class="mt-2 space-y-2 text-sm leading-relaxed text-slate-700 dark:text-slate-300">
                            <ul class="space-y-1">
                                <li><span class="font-semibold">Name:</span>
                                    <%= OWNER_NAME %>
                                </li>

                                <% if (OWNER_ADDRESS && String(OWNER_ADDRESS).trim()) { %>
                                    <li><span class="font-semibold">Address:</span>
                                        <%= OWNER_ADDRESS %>
                                    </li>
                                    <% } %>

                                        <li>
                                            <span class="font-semibold">Email:</span>
                                            <a class="underline underline-offset-4" href="mailto:<%= SUPPORT_EMAIL %>">
                                                <%= SUPPORT_EMAIL %>
                                            </a>
                                        </li>

                                        <% if (SUPPORT_PEC && String(SUPPORT_PEC).trim()) { %>
                                            <li>
                                                <span class="font-semibold">PEC:</span>
                                                <a class="underline underline-offset-4"
                                                    href="mailto:<%= SUPPORT_PEC %>">
                                                    <%= SUPPORT_PEC %>
                                                </a>
                                            </li>
                                            <% } %>
                            </ul>

                            <p class="text-xs text-slate-600 dark:text-slate-400">Last update: <%= LAST_UPDATED %>
                            </p>
                        </div>
                    </section>

                </div>
            </main>

            <!-- Footer -->
            <%- include('../partials/footer') %>
    </section>

    <script>
        (function () {
            const root = document.documentElement;
            const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;

            function numCssVar(name) {
                const v = getComputedStyle(root).getPropertyValue(name);
                const n = parseFloat(v);
                return Number.isFinite(n) ? n : 0;
            }

            function setSafeVars() {
                let top = 0;
                let bottom = 0;

                // Prefer Telegram provided insets (new clients)
                try {
                    top = tg?.safeAreaInset?.top ?? 0;
                    bottom = tg?.safeAreaInset?.bottom ?? 0;
                } catch (e) { }

                // Fallback to Telegram CSS vars if present
                if (!top) top = numCssVar('--tg-safe-area-inset-top');
                if (!bottom) bottom = numCssVar('--tg-safe-area-inset-bottom');

                // Last fallback for iOS-like devices if everything is 0
                if (!top && /iPhone|iPad|iPod/i.test(navigator.userAgent)) top = 24;

                root.style.setProperty('--app-safe-top', top + 'px');
                root.style.setProperty('--app-safe-bottom', bottom + 'px');
            }

            setSafeVars();

            // Keep it updated when Telegram reports changes
            try { tg?.onEvent?.('safeAreaChanged', setSafeVars); } catch (e) { }
            try { tg?.onEvent?.('safe_area_changed', setSafeVars); } catch (e) { } // some wrappers emit snake_case [web:203][web:128]

            // Optional: set header/background color so status bar icons look correct in fullscreen [page:1]
            try {
                if (tg?.setHeaderColor && tg?.colorScheme) {
                    tg.setHeaderColor(tg.colorScheme === 'dark' ? '#020617' : '#f8fafc');
                }
                if (tg?.setBackgroundColor && tg?.colorScheme) {
                    tg.setBackgroundColor(tg.colorScheme === 'dark' ? '#020617' : '#f8fafc');
                }
            } catch (e) { }
        })();

        try {
            function goBack() {
                if (window.history.length > 1) return window.history.back();
                return window.location.href = "/<%= token %>/group-help-advance";
            }
            const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
            if (tg?.BackButton) {
                tg.BackButton.show();
                tg.BackButton.onClick(goBack);
            }
        } catch (e) { }
    </script>

    <!-- Ads on first page load (client-only) -->
    <script>
        (function () {
            const ADS_BLOCK_ID = 'int-20013'; // <-- replace with your AdsGram block id
            const SESSION_KEY = 'ads_shown_find_movies_v1';
            const SAFETY_TIMEOUT_MS = 8000;
            let AdController = null;
            let sdkLoaded = false;
            let sdkRequested = false;

            function loadAdsgramSDK() {
                return new Promise((resolve) => {
                    if (sdkRequested) {
                        // wait until sdkLoaded becomes true or small timeout
                        const start = Date.now();
                        const check = setInterval(() => {
                            if (sdkLoaded || (Date.now() - start) > 1200) { clearInterval(check); resolve(sdkLoaded); }
                        }, 100);
                        return;
                    }
                    sdkRequested = true;

                    if (window.Adsgram && typeof window.Adsgram.init === 'function') {
                        try {
                            AdController = window.Adsgram.init({ blockId: ADS_BLOCK_ID });
                            sdkLoaded = true;
                            resolve(true);
                            return;
                        } catch (e) {
                            console.error('Adsgram init error:', e);
                        }
                    }

                    const s = document.createElement('script');
                    s.src = 'https://sad.adsgram.ai/js/sad.min.js';
                    s.async = true;
                    s.onload = function () {
                        try {
                            if (window.Adsgram && typeof window.Adsgram.init === 'function') {
                                AdController = window.Adsgram.init({ blockId: ADS_BLOCK_ID });
                                sdkLoaded = true;
                                resolve(true);
                                return;
                            }
                        } catch (err) {
                            console.error('Adsgram init after load failed:', err);
                        }
                        resolve(false);
                    };
                    s.onerror = function () {
                        console.error('Failed to load Adsgram SDK.');
                        resolve(false);
                    };
                    document.head.appendChild(s);

                    // fallback resolve after short delay in case onload doesn't fire quickly
                    setTimeout(() => { if (!sdkLoaded) resolve(sdkLoaded); }, 1200);
                });
            }

            async function showAdIfNeeded() {
                try {
                    // Only show once per session/tab
                    if (sessionStorage.getItem(SESSION_KEY)) return;

                    // try to load SDK (non-blocking)
                    const ready = await loadAdsgramSDK();

                    // if no SDK, do nothing
                    if (!ready || !AdController || typeof AdController.show !== 'function') return;

                    // show ad with safety timeout
                    const t = setTimeout(() => {
                        // if ad didn't start / resolve within timeout, just mark shown so we don't retry
                        try { sessionStorage.setItem(SESSION_KEY, '1'); } catch (e) { }
                    }, SAFETY_TIMEOUT_MS);

                    try {
                        const res = await AdController.show();
                        clearTimeout(t);
                        // mark as shown regardless of completion/skipped to avoid repeat
                        try { sessionStorage.setItem(SESSION_KEY, '1'); } catch (e) { }
                    } catch (err) {
                        clearTimeout(t);
                        console.error('Adsgram show error:', err);
                        try { sessionStorage.setItem(SESSION_KEY, '1'); } catch (e) { }
                    }
                } catch (e) {
                    console.error('Error while attempting to show ad on page load', e);
                    try { sessionStorage.setItem(SESSION_KEY, '1'); } catch (e) { }
                }
            }

            // Run on DOMContentLoaded - ensure page UI is ready first
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', showAdIfNeeded);
            } else {
                showAdIfNeeded();
            }
        })();
    </script>