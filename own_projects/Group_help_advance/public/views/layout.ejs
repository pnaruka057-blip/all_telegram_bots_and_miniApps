<!DOCTYPE html>
<html lang="en" class="h-full">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src='//libtl.com/sdk.js' data-zone='9690148' data-sdk='show_9690148'></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script async src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <style>
        /* Make the page truly fill the Telegram viewport */
        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }

        /* Telegram exposes viewport height as CSS var in Mini Apps environments */
        body {
            min-height: var(--tg-viewport-height, 100vh);
            height: var(--tg-viewport-height, 100vh);
            overflow-x: hidden;
        }

        .hidden {
            display: none;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .animate-background {
            background: linear-gradient(-45deg, #0f0f0f, #1a1a40, #3d0000, #1a1a40);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
            color: #f5f5f5;
        }

        .animate-background h1,
        .animate-background p {
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.6);
        }

        .animate-background label {
            color: white;
        }

        .animate-background input,
        .animate-background select {
            color: black;
        }

        .truncate-3-lines {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        @keyframes verticalScroll {
            0% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-20%);
            }

            100% {
                transform: translateY(0);
            }
        }

        .animate-verticalScroll {
            animation: verticalScroll 8s ease-in-out infinite;
        }
    </style>

    <script>
        window.addEventListener("DOMContentLoaded", async () => {
            const waitForTelegram = async (timeoutMs = 700) => {
                const start = Date.now();
                while (!(window.Telegram && window.Telegram.WebApp) && (Date.now() - start) < timeoutMs) {
                    await new Promise(r => setTimeout(r, 50));
                }
                return !!(window.Telegram && window.Telegram.WebApp);
            };

            const tgAvailable = await waitForTelegram(700);
            if (!tgAvailable) {
                document.body.innerHTML =
                    '<div class="text-center mt-10 text-red-600 text-lg">Please open this in Telegram</div>';
                return;
            }

            const tg = window.Telegram.WebApp;

            try { tg.ready?.(); } catch (e) { }
            try { tg.expand?.(); } catch (e) { } // max available height [web:125]

            // Fullscreen request (supported devices only) [web:125]
            // try { tg.requestFullscreen?.(); } catch (e) { }

            // Optional: keep viewport vars in sync for layout stability
            // const syncVh = () => {
            //     try {
            //         if (typeof tg.viewportHeight === "number") {
            //             document.documentElement.style.setProperty("--tg-viewport-height", tg.viewportHeight + "px");
            //         }
            //     } catch (e) { }
            // };

            // try {
            //     tg.onEvent?.("viewportChanged", syncVh);
            //     syncVh();
            // } catch (e) { }

            const initDataUnsafe = tg.initDataUnsafe || {};
            const user = initDataUnsafe.user;

            if (!user) {
                document.body.innerHTML =
                    '<div class="text-center mt-10 text-red-600 text-lg">Please open this in Telegram</div>';
                return;
            }
        });
    </script>
</head>

<body class="w-full select-none pt-20">
    <!-- Page Loader -->
    <div id="pageLoader"
        class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] flex items-center justify-center hidden">
        <div class="flex space-x-2">
            <div class="w-3 h-3 bg-white rounded-full animate-bounce [animation-delay:0s]"></div>
            <div class="w-3 h-3 bg-white rounded-full animate-bounce [animation-delay:0.2s]"></div>
            <div class="w-3 h-3 bg-white rounded-full animate-bounce [animation-delay:0.4s]"></div>
        </div>
    </div>

    <%- body %>

        <script>
            document.addEventListener("DOMContentLoaded", () => {
                document.body.addEventListener("click", function (e) {
                    const link = e.target.closest("a");
                    if (!link) return;

                    const href = link.getAttribute("href");
                    if (href && !href.startsWith("http") && !href.startsWith("#") && !link.hasAttribute("target")) {
                        document.getElementById("pageLoader").classList.remove("hidden");
                    }
                });
            });
        </script>
</body>

</html>